<!DOCTYPE html>  <html> <head>   <title>model.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="client.html">                 client.js               </a>                                           <a class="source" href="model.html">                 model.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               model.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">showdown</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Showdown</span><span class="p">.</span><span class="nx">converter</span><span class="p">();</span>
<span class="k">this</span><span class="p">.</span><span class="nx">CKAN</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">CKAN</span> <span class="o">||</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Global object that stores all CKAN models.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">CKAN</span><span class="p">.</span><span class="nx">Model</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">Backbone</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">Model</span> <span class="o">=</span> <span class="p">{};</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>A Base model that all CKAN models inherit from. Methods that should be
shared across all models should be defined here. </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Model</span><span class="p">.</span><span class="nx">Base</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Extend the default Backbone.Model constructor simply to provide a named
function. This improves debugging in consoles such as the Webkit inspector.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">Base</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Rather than letting the models connect to the server themselves we
leave this to the implementor to decide how models are saved. This allows
the API details such as API key and enpoints to change without having
to update the models. When <code>.save()</code> or <code>.destroy()</code> is called the
<code>"sync"</code> event will be published with the arguments provided to <code>.sync()</code>.</p>

<p>var package = new Package({name: 'My Package Name'});
   package.bind('sync', Backbone.sync);</p>

<p>This method returns itself for chaining.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">sync</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;sync&#39;</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">)));</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Model objects</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Model</span><span class="p">.</span><span class="nx">Dataset</span> <span class="o">=</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">Base</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">Dataset</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">Model</span><span class="p">.</span><span class="nx">Base</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>NOTE: Returns localised URL.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">toTemplateJSON</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">ckan_url</span> <span class="o">=</span> <span class="s1">&#39;/package/&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">displaytitle</span> <span class="o">=</span> <span class="nx">title</span> <span class="o">?</span> <span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;No title ...&#39;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">notes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">);</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">notesHtml</span> <span class="o">=</span> <span class="nx">showdown</span><span class="p">.</span><span class="nx">makeHtml</span><span class="p">(</span><span class="nx">notes</span> <span class="o">?</span> <span class="nx">notes</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
      <span class="nx">out</span><span class="p">.</span><span class="nx">snippet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">makeSnippet</span><span class="p">(</span><span class="nx">out</span><span class="p">.</span><span class="nx">notesHtml</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
    <span class="p">},</span>

    <span class="nx">makeSnippet</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">notesHtml</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">out</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">notesHtml</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">out</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">190</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">out</span> <span class="o">=</span> <span class="nx">out</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">190</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ...&#39;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">out</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">Model</span><span class="p">.</span><span class="nx">Resource</span> <span class="o">=</span> <span class="nx">Model</span><span class="p">.</span><span class="nx">Base</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">Resource</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">Model</span><span class="p">.</span><span class="nx">Base</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">validate</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">attrs</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">attrs</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="s1">&#39;url&#39;</span><span class="o">:</span> <span class="s1">&#39;URL must be set&#39;</span>
        <span class="p">};</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Collection for managing results from the CKAN search API. An additional
<code>options.total</code> parameter can be provided on initialisation to
indicate how many models there are on the server in total. This can
then be accessed via the <code>total</code> property.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Model</span><span class="p">.</span><span class="nx">SearchCollection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="nx">SearchCollection</span><span class="p">(</span><span class="nx">models</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">total</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">total</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="nx">Model</span><span class="p">;</span>

<span class="p">}(</span><span class="k">this</span><span class="p">.</span><span class="nx">jQuery</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 